#!/bin/sh
###############################################################################
##### SYSTEM UPDATE                                                     #######
###############################################################################
function update(){
    echo '-------------------------'
    echo '---------- DNF ----------'
    echo '-------------------------'
    sudo dnf update --refresh
    echo ''

    echo '-------------------------'
    echo '------- Flatpak ---------'
    echo '-------------------------'
    flatpak update -y
}

###############################################################################
##### GRUB UPDATE                                                       #######
###############################################################################
function grub-update(){
    echo "Update grub"
    sudo grub2-mkconfig -o /etc/grub2.cfg
    sudo grub2-mkconfig -o /etc/grub2-efi.cfg
}

###############################################################################
##### UPDATE MAJOR TOOLS                                                #######
###############################################################################
function update-tools(){
    __update-rust
    __update-starship
    __update-emscripten
    # __update-espIdf
    __update-poetry
    __update-android-udev
}

function __update-rust(){
    # Rust Update
    echo '-------------------------'
    echo '-------- RUST -----------'
    echo '-------------------------'
    rustup update
    echo ''
}

function __update-starship(){
    # Rust Update
    echo '-------------------------'
    echo '------ STARSHIP ---------'
    echo '-------------------------'
    curl -sS https://starship.rs/install.sh | sh -s -- --bin-dir ~/.local/bin -y
    echo ''
}

function __update-emscripten(){
    # # Emscripten update
    echo '-------------------------'
    echo '----- EMSCRIPTEN --------'
    echo '-------------------------'
    cd ~/Software/emsdk
    pull=$(git pull)
    if [[ $pull != "Already up to date." ]];
    then
        ~/Software/emsdk/emsdk install latest
        ~/Software/emsdk/emsdk activate latest
    else
        echo $pull
    fi
    cd ~
    echo ''
}

function __update-espIdf(){
    # Esp-Idf
    echo '-------------------------'
    echo '------- ESP-IDF ---------'
    echo '-------------------------'
    cd ~/Software/esp-idf
    pull=$(git pull)
    if [[ $pull != "Already up to date." ]];
    then
        git pull --recurse-submodules
        sh ~/Software/esp-idf/install.sh
    else
        echo $pull
    fi
    cd ~
    echo ''
}

function __update-poetry(){
    # Poetry
    echo '-------------------------'
    echo '------- POETRY  ---------'
    echo '-------------------------'
    poetry self update
    echo ''
}

function __update-android-udev(){
    # Android Udev Rules
    # https://github.com/M0Rf30/android-udev-rules
    echo '-------------------------'
    echo '------- ANDROID ---------'
    echo '-------------------------'
    cd ~/Software/Android/android-udev-rules
    git pull
    cd ~
    echo ''
}

###############################################################################
####### BACKUP                                                           ######
###############################################################################
function tar-pack(){
    filename=$(basename $1)
    tar --zstd -cvf $filename.tar.zst $1
}

function tar-unpack(){
    tar --zstd -xvf $1
}
