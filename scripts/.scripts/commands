#!/bin/bash
update() {
    echo '-------------------------'
    echo '-------- UPDATE ---------'
    echo '-------------------------'
    if [[ $(lsb_release -is) == "Debian" || $(lsb_release -is) == "Ubuntu" ]]; then
        sudo apt update && sudo apt upgrade
    elif [[ $(lsb_release -is) == "Fedora" ]]; then
        sudo dnf update --refresh
    fi
    echo ''

    echo '-------------------------'
    echo '-------- FLATPAK --------'
    echo '-------------------------'
    flatpak update -y
    echo ''

    __update-rust

    if [[ $(lsb_release -is) == "Debian" || $(lsb_release -is) == "Ubuntu" ]]; then
        __update-neovim
        __update-fzf
    fi
}

__update-rust() {
    echo '-------------------------'
    echo '---------- RUST ---------'
    echo '-------------------------'
    rustup update
    if [[ $(lsb_release -is) == "Debian" || $(lsb_release -is) == "Ubuntu" ]]; then
        cargo-binstall --no-confirm zoxide bat eza fd-find ripgrep sd procs just deno
    fi
    echo ''
}

__update-neovim() {
    echo '-------------------------'
    echo '-------- NEOVIM ---------'
    echo '-------------------------'
    curl -L https://github.com/neovim/neovim/releases/latest/download/nvim-linux64.tar.gz -o /tmp/nvim-linux64.tar.gz
    rm -rf ~/Software/nvim-linux64
    tar -C ~/Software -xzf /tmp/nvim-linux64.tar.gz
    echo ''
}

__update-fzf() {
    echo '-------------------------'
    echo '---------- FZF ----------'
    echo '-------------------------'
    git -C ~/Software/fzf pull
    ~/Software/fzf/install --bin
    echo ''
}

up() { cd $(eval printf '../'%.0s {1..$1}); }

set-gtk-theme() {
    dbus-send --session --dest=org.kde.GtkConfig --type=method_call /GtkConfig org.kde.GtkConfig.setGtkTheme 'string:Arc-Dark'
}

tar-pack() {
    local filename=$(basename "$1")
    tar --zstd -cvf "${filename}.tar.zst" "$1"
}

tar-unpack() {
    tar --zstd -xvf "$1"
}

backup-files() {
    cd ~ || exit
    # List of directories and files to back up
    [[ ! -d ~/.var/app/com.brave.Browser/config/BraveSoftware ]] || tar-pack .var/app/com.brave.Browser/config/BraveSoftware
    [[ ! -d ~/.dotfiles ]] || tar-pack .dotfiles
    [[ ! -d ~/Private ]] || tar-pack Private
    [[ ! -d ~/Work ]] || tar-pack Work
    [[ ! -d ~/Projects ]] || tar-pack Projects
    [[ ! -d ~/.ssh ]] || tar-pack .ssh
    [[ ! -f ~/.gitconfig ]] || tar-pack .gitconfig
}
